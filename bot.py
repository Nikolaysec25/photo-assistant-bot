import logging
import asyncio
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiohttp import web
import os

logging.basicConfig(level=logging.INFO)
BOT_TOKEN = os.getenv("BOT_TOKEN")

# ‚ö†Ô∏è –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π Telegram ID (—É–∑–Ω–∞–π —É @userinfobot)
ADMIN_ID = 1054983240

bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()

# ===============================
# üîπ –°–ª–æ–≤–∞—Ä—å –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤
# ===============================
FAQ = {
    "—Ü–µ–Ω–∞": "üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞: –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è ‚Äî –æ—Ç 120 BYN, —Å–µ–º–µ–π–Ω–∞—è ‚Äî –æ—Ç 150 BYN, love story ‚Äî –æ—Ç 180 BYN.",
    "—Å—Ç–æ–∏–º–æ—Å—Ç—å": "üí∞ –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å ‚Äî –æ—Ç 120 BYN. –í –Ω–µ—ë –≤—Ö–æ–¥–∏—Ç —Å—ä—ë–º–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ.",
    "—Ñ–æ—Ç–æ—Å–µ—Å—Å–∏—è": "üì∏ –ü—Ä–æ–≤–æ–∂—É —Ä–∞–∑–Ω—ã–µ –≤–∏–¥—ã —Å—ä—ë–º–æ–∫: –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ, —Å–µ–º–µ–π–Ω—ã–µ, –¥–µ—Ç—Å–∫–∏–µ, love story, –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏ –∫–æ–Ω—Ç–µ–Ω—Ç.",
    "–≤–∏–¥—ã": "üì∑ –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–∞—è, —Å–µ–º–µ–π–Ω–∞—è, love story, –∫–æ–Ω—Ç–µ–Ω—Ç, –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è.",
    "–º–µ—Å—Ç–æ": "üìç –°—ä—ë–º–∫–∞ –≤ —Å—Ç—É–¥–∏–∏ –∏–ª–∏ –Ω–∞ —É–ª–∏—Ü–µ. –ü–æ–º–æ–≥—É –≤—ã–±—Ä–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é –ø–æ–¥ –≤–∞—à —Å—Ç–∏–ª—å.",
    "–ª–æ–∫–∞—Ü–∏—è": "üåø –°—Ç—É–¥–∏–∏ –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞ –∏ –∫—Ä–∞—Å–∏–≤—ã–µ –º–µ—Å—Ç–∞ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ. –ú–æ–≥—É –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã.",
    "—Å–≤–æ–±–æ–¥–µ–Ω": "üìÖ –ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ –¥–∞—Ç—ã, –Ω–∞–ø–∏—à–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω—ã–π –¥–µ–Ω—å ‚Äî –ø—Ä–æ–≤–µ—Ä—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.",
    "–¥–∞—Ç–∞": "üìÜ –£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É, –∏ —è –ø–æ—Å–º–æ—Ç—Ä—é, —Å–≤–æ–±–æ–¥–µ–Ω –ª–∏ —ç—Ç–æ—Ç –¥–µ–Ω—å.",
    "–±—Ä–æ–Ω—å": "üì≤ –î–ª—è –±—Ä–æ–Ω–∏ –¥–∞—Ç—ã –Ω—É–∂–Ω–∞ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 30 BYN. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –¥–µ–Ω—å –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è –∑–∞ –≤–∞–º–∏.",
    "—Å—Ä–æ–∫": "‚è≥ –ì–æ—Ç–æ–≤—ã–µ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ 7‚Äì10 –¥–Ω–µ–π –ø–æ—Å–ª–µ —Å—ä—ë–º–∫–∏.",
    "–∫–æ–≥–¥–∞": "üì∏ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–µ–¥–µ–ª—é.",
    "—Ñ–æ—Ç–æ": "üì∏ –û—Ç–¥–∞—é –æ—Ç 30 –¥–æ 60 –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞.",
    "–æ–±—Ä–∞–±–æ—Ç–∫–∞": "üñå –û–±—Ä–∞–±–æ—Ç–∫–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è, –±–µ–∑ —Å–∏–ª—å–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤. –ü–æ–¥—á—ë—Ä–∫–∏–≤–∞—é —Ü–≤–µ—Ç –∏ —Å–≤–µ—Ç.",
    "–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ": "üì∏ –û–±—ã—á–Ω–æ –æ—Ç–¥–∞—é 30‚Äì60 —Ñ–æ—Ç–æ.",
    "–∫–æ–Ω—Ç–∞–∫—Ç—ã": "üìû –°–≤—è–∑–∞—Ç—å—Å—è –º–æ–∂–Ω–æ –∑–¥–µ—Å—å –∏–ª–∏ –≤ Instagram: @photo_assistant_example",
    "–∏–Ω—Å—Ç–∞": "üì∑ Instagram: @photo_assistant_example"
}

# ===============================
# üîπ /start
# ===============================
@dp.message(Command("start"))
async def start_command(message: types.Message):
    name = message.from_user.first_name or "–¥—Ä—É–≥"
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    buttons = [
        ["üí∞ –¶–µ–Ω–∞", "üì∏ –í–∏–¥—ã —Å—ä—ë–º–æ–∫"],
        ["üìÖ –°–≤–æ–±–æ–¥–Ω—ã–µ –¥–∞—Ç—ã", "üìç –ú–µ—Å—Ç–æ —Å—ä—ë–º–∫–∏"],
        ["‚è≥ –°—Ä–æ–∫–∏", "üì∑ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ"]
    ]
    keyboard.add(*[types.KeyboardButton(b) for row in buttons for b in row])
    
    await message.answer(
        f"–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {name}! üëã\n"
        "–Ø –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞.\n\n"
        "–ú–æ–≥—É –ø–æ–º–æ—á—å —Å —Å–∞–º—ã–º–∏ —á–∞—Å—Ç—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏:\n"
        "üí∞ –¶–µ–Ω–∞ —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏–∏\n"
        "üìÖ –°–≤–æ–±–æ–¥–Ω—ã–µ –¥–∞—Ç—ã\n"
        "üìç –ì–¥–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å—ä—ë–º–∫–∏\n"
        "üì∑ –°–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ –æ—Ç–¥–∞—ë—Ç—Å—è\n"
        "‚è≥ –°—Ä–æ–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∏–∂–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å üëá",
        reply_markup=keyboard
    )

# ===============================
# üîπ –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
# ===============================
@dp.message()
async def handle_message(message: types.Message):
    text = message.text.lower()
    name = message.from_user.first_name or "–¥—Ä—É–≥"
    answer_sent = False

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ—Ç–≤–µ—Ç –≤ FAQ
    for key, answer in FAQ.items():
        if key in text:
            await message.answer(f"{name}, {answer}")
            answer_sent = True
            break

    # –ü–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ ‚Äî –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
    if answer_sent:
        keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
        keyboard.add("‚úÖ –•–æ—á—É, —á—Ç–æ–±—ã —Å–æ –º–Ω–æ–π —Å–≤—è–∑–∞–ª–∏—Å—å", "‚ùå –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ —Å–º–æ—Ç—Ä—é")
        await message.answer(
            f"{name}, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ —Å–≤—è–∑–∞–ª—Å—è —Å –≤–∞–º–∏ –ª–∏—á–Ω–æ ‚Äî –Ω–∞–∂–º–∏—Ç–µ –Ω–∏–∂–µ üëá",
            reply_markup=keyboard
        )
    else:
        await message.answer(
            f"{name}, —è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞ üåø –ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ —Ü–µ–Ω—ã, –¥–∞—Ç—ã –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç —Å—ä—ë–º–∫–∏.\n"
            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏—è?¬ª"
        )

# ===============================
# üîπ –ö–Ω–æ–ø–∫–∞ ¬´–•–æ—á—É, —á—Ç–æ–±—ã —Å–æ –º–Ω–æ–π —Å–≤—è–∑–∞–ª–∏—Å—å¬ª
# ===============================
@dp.message(lambda m: m.text == "‚úÖ –•–æ—á—É, —á—Ç–æ–±—ã —Å–æ –º–Ω–æ–π —Å–≤—è–∑–∞–ª–∏—Å—å")
async def contact_request(message: types.Message):
    user = message.from_user
    name = user.first_name or "–ö–ª–∏–µ–Ω—Ç"

    await message.answer(
        f"–û—Ç–ª–∏—á–Ω–æ, {name}! üôå –Ø –ø–µ—Ä–µ–¥–∞–ª —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—É, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è.\n"
        "–û–Ω —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è!"
    )

    msg_to_admin = (
        f"üìû –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç, —á—Ç–æ–±—ã —Å –Ω–∏–º —Å–≤—è–∑–∞–ª–∏—Å—å!\n\n"
        f"–ò–º—è: {user.full_name}\n"
        f"Username: @{user.username if user.username else '‚Äî'}\n"
        f"ID: {user.id}"
    )
    try:
        await bot.send_message(ADMIN_ID, msg_to_admin)
    except Exception as e:
        logging.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É: {e}")

# ===============================
# üîπ –ö–Ω–æ–ø–∫–∞ ¬´–ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ —Å–º–æ—Ç—Ä—é¬ª
# ===============================
@dp.message(lambda m: m.text == "‚ùå –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ —Å–º–æ—Ç—Ä—é")
async def contact_decline(message: types.Message):
    name = message.from_user.first_name or "–¥—Ä—É–≥"
    await message.answer(f"–•–æ—Ä–æ—à–æ, {name} üåø –ï—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã ‚Äî —è –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏!")

# ===============================
# üîπ Render web server
# ===============================
async def handle(request):
    return web.Response(text="Bot is running!")

async def web_server():
    app = web.Application()
    app.add_routes([web.get("/", handle)])
    runner = web.AppRunner(app)
    await runner.setup()
    site = web.TCPSite(runner, "0.0.0.0", 10000)
    await site.start()

async def main():
    bot_task = asyncio.create_task(dp.start_polling(bot))
    web_task = asyncio.create_task(web_server())
    await asyncio.gather(bot_task, web_task)

if __name__ == "__main__":
    logging.info("üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–º...")
    asyncio.run(main())
